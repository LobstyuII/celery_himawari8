This is an experimental version intended for my personal research purposes. The final version may be released following the publication of related papers. It has been tested successfully on Unix-based servers; however, it encounters issues when run on Windows-based Anaconda environments. These issues are likely due to inherent limitations with Celery on Windows. For more details, please refer to the [Celery website](https://docs.celeryproject.org/en/stable/faq.html#does-celery-support-windows).

This program utilizes **Celery** and **Redis** to process Himawari-8 L1 data into L2 Surface Reflectance data. In addition to the Himawari-8 L1 Gridded Data, the program also incorporates Himawari-8 L2 ARP data, MOD08 data, and MCD12Q1 data for atmospheric correction. Given the vast amount of data generated by the Himawari satellite—producing billions of pixels daily—we've developed a 6S correction module tailored for specific geographic Points of Interest (POIs). This allows for the efficient extraction of clear-sky data for selected dates and coordinates. 

The repository is configured for use with Conda, ensuring a consistent and reproducible environment.

## Prerequisites

· Conda

· Python 3.x

· Earthdata token for NASA API

## Installation

1. Clone the repository:

`git clone https://github.com/LobstyuII/celery_himawari8.git`

`cd celery_himawari8

2. Create the Conda environment using the provided `environment.yml` file:

`conda env create -f environment.yml`

## Configuration

### 1. Configure environment

Configure your conda environment:

`conda activate celery_env`

Then, run redis.exe:

`redis-server`

Configure your celery:

`celery -A celery_app worker --loglevel=info`
### 2. Set Up Earthdata Token

Ensure that the `my_NASA_API_token` file is placed in the root directory of this project. This file should contain your personal Earthdata token, necessary for accessing NASA's API.

### 3. Download Preprocessed Data

Download the preprocessed MCD12Q1 data from the provided Baidu Netdisk(https://pan.baidu.com/s/1bUYW05NnpJ82qdi6Jri2KQ?pwd=i4bu 
) link and place it in the root directory under `preprocessing_data`. This dataset has been resampled to match the Himawari-8 Full-Disk data.

### 4. Update FTP Connection Information

Replace the following lines in your configuration with your own FTP credentials:

python

`FTP_ADDRESS = "ftp.ptree.jaxa.jp"   FTP_UID = "YourFTPUsername"   FTP_PW = "YourFTPPassword"`

## Usage

To initiate the analysis, simply run:

`python main.py`

This will execute the necessary scripts for data processing and analysis.

To process data from certain dates, replace the following lines in `main.py`:
```
dates_to_process = ['2015-07-13', '2015-07-14', '2015-07-15']  
hours_to_process = [3, 4, 5]
```

## Introduction

This project is divided into several core components, each responsible for a specific part of the download/analysis process.

The POI data is provided in the `Air_stations_lon_lat.csv` file located in the root directory. This file contains station IDs in string format, with latitude and longitude coordinates adhering to the WGS84 reference system.

## Contact

For any questions or issues, please reach out via 2001212684@alumni.pku.edu.cn.