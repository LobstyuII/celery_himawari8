This is an experimental version intended for my personal research purposes. The final version may be released following the publication of related papers. It has been tested successfully on Unix-based servers; however, it encounters issues when run on Windows-based Anaconda environments. These issues are likely due to inherent limitations with Celery on Windows. For more details, please refer to the [Celery website](https://docs.celeryproject.org/en/stable/faq.html#does-celery-support-windows).

This program utilizes **Celery** and **Redis** to process Himawari-8 L1 data into L2 Surface Reflectance data. In addition to the Himawari-8 L1 Gridded Data, the program also incorporates Himawari-8 L2 ARP data, MOD08 data, and MCD12Q1 data for 6S atmospheric correction. Given the vast amount of data generated by the Himawari satellite—producing billions of pixels daily—we've developed an automated workflow with Py6S module tailored for specific geographic Points of Interest (POIs). This allows for the efficient extraction of clear-sky data for selected dates and coordinates. 

The repository is configured for use with Conda, ensuring a consistent and reproducible environment.

## Prerequisites

· Conda

· Python 3.x

· Earthdata token for NASA API

· a JAXA account to access to the P-Tree system

## Installation

1. Clone the repository:

```
sudo -i
git clone https://github.com/LobstyuII/celery_himawari8.git
cd celery_himawari8
```

2. Create the Conda environment:

`conda create -n celery_env -c conda-forge celery[redis] redis-py tqdm netCDF4 matplotlib requests Py6S pandas gdal`

## Configuration

### 1. Configure environment

Configure your conda environment:

`conda activate celery_env`

Then, run redis.exe:

`redis-server`

Configure your celery:

`celery -A celery_app worker --loglevel=info`
### 2. Set Up Earthdata Token

Ensure that the `my_NASA_API_token` file is placed in the root directory of this project. This file must contain your personal Earthdata token, which is required to access NASA's API.

To obtain your personal token:

1. Log in to your Earthdata account at: [https://urs.earthdata.nasa.gov/profile](https://urs.earthdata.nasa.gov/profile)
   
2. Navigate to the **Application - Authorized Apps** tab and ensure the following applications are authorized:
   - **NASA GESDISC DATA ARCHIVE**
   - **LP DAAC Data Pool**

3. Go to the **Generate Token** tab to create your personal token.

Once you have your token, save it to the appropriate location using the following command:

`echo "your_copied_token_here" > ~/celery_himawari8/my_NASA_API_token`

### 4. Update jaxa FTP Connection Information

Replace the following lines in your configuration with your own FTP credentials:

python

`FTP_ADDRESS = "ftp.ptree.jaxa.jp"   FTP_UID = "YourFTPUsername"   FTP_PW = "YourFTPPassword"`

## Usage

To initiate the analysis, open a new terminal, 

`sudo -i`

and simply run:

```
conda activate celery_env
cd celery_himawari8
python main.py
```

This will execute the necessary scripts for data processing and analysis.

To process data from certain dates, replace the following lines in `main.py`:
```
date_str = ['2015-07-13']  
hour = 4
```

## Introduction

This project is divided into several core components, each responsible for a specific part of the download/analysis process.

The POI data is provided in the `Air_stations_lon_lat.csv` file located in the root directory. This file contains station IDs in string format, with latitude and longitude coordinates adhering to the WGS84 reference system.

## Contact

For any questions or issues, please reach out via 2001212684@alumni.pku.edu.cn.